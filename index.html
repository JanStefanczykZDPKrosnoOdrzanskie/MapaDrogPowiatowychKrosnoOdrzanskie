<!DOCTYPE html>
<html lang="pl">
<head>
    <style>   
#baseLayerSelector {
  position: absolute;
  top: 10px;
  right: 10px;
  z-index: 20;
  background: white;
  padding: 6px;
  border-radius: 4px;
  font-family: Arial, sans-serif;
}
</style>
    
<meta charset="UTF-8">
<title>Mapa ZDP</title>

<link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet"/>
<script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>

<style>

body{
margin:0;
padding:0;
}

#map{
position:absolute;
top:0;
bottom:0;
width:100%;
}

#legend{
position:absolute;
top:10px;
left:10px;
z-index:10;
background:white;
padding:10px;
border-radius:5px;
box-shadow:0 0 5px rgba(0,0,0,0.3);
font-family:Arial,sans-serif;
font-size:14px;
}

.legend-line{
display:inline-block;
width:40px;
height:3px;
margin-right:5px;
vertical-align:middle;
}

/* Timestamp overlay */

#updateOverlay{
position:absolute;
top:10px;
left:50%;
transform:translateX(-50%);
z-index:20;
background:white;
padding:6px 12px;
border-radius:5px;
box-shadow:0 0 4px rgba(0,0,0,0.3);
font-family:Arial,sans-serif;
font-size:14px;
}

</style>
</head>

<body>
    
<div id="legend">

<h3>Legenda 2</h3>

<label>
<input type="checkbox" data-layers="layer_adm_1" checked>
<span class="legend-line" style="background:#FF0000"></span>
Droga Krajowa
</label><br>

<label>
<input type="checkbox" data-layers="layer_adm_2" checked>
<span class="legend-line" style="background:#08FF00"></span>
Droga Wojewewódzka
</label><br>

<label>
<input type="checkbox" data-layers="layer_adm_3" checked>
<span class="legend-line" style="background:#A500AD"></span>
Droga Powiatowa
</label><br>

<label>
<input type="checkbox" data-layers="layer_zud_2" checked>
<span class="legend-line" style="background:#FFEE00"></span>
Standard 2
</label><br>

<label>
<input type="checkbox" data-layers="layer_zud_3" checked>
<span class="legend-line" style="background:#00FFFF"></span>
Standard 3
</label><br>

<label>
<input type="checkbox" data-layers="layer_zud_4" checked>
<span class="legend-line" style="background:#FA9EFF"></span>
Standard 4
</label><br>

<label>
<input type="checkbox" data-layers="layer_zud_6" checked>
<span class="legend-line" style="background:#A1A1A1"></span>
Standard 6
</label>

</div>

<div id="updateOverlay">Aktualizacja: --</div>

    <div id="baseLayerSelector">
  <select id="basemapSelect">
    <option value="osm">OpenStreetMap</option>
    <option value="BDOT10k-BDOO">BDOO/BDOT10k</option>
    <option value="Ortofoto">Ortofotomapa</option>
    <option value="TOPO">Mapa topograficzna</option>
    <option value="VMap">Vector Smart Map (VMap)</option>
  </select>
</div>
    
<div id="map"></div>

<script>

/* ===============================
MAP INSTANCE
=============================== */

const map = new maplibregl.Map({

container:'map',

style:{
version:8,

glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf",

sources:{},

layers:[]

},

center:[14.8953712,52.01625],
zoom:10

});

/* ===============================
BASE MAP SWITCHER
=============================== */

function setBaseLayer(type){

if(map.getLayer("base_raster")){
map.removeLayer("base_raster");
}

if(map.getSource("base_raster")){
map.removeSource("base_raster");
}

let sourceConfig = null;

switch(type){

case "osm":
sourceConfig = {
type:"raster",
tiles:[
"https://tile.openstreetmap.org/{z}/{x}/{y}.png"
],
tileSize:256
};
break;

case "BDOT10k-BDOO":
sourceConfig = {
type:"raster",
tiles:[
"https://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/BDOT10k-BDOO/Default/GoogleMapsCompatible/{z}/{y}/{x}.jpeg"
],
tileSize:256
};
break;

case "Ortofoto":
sourceConfig = {
type:"raster",
tiles:[
"https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMS/StandardResolution?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/jpeg&CRS=EPSG:3857&WIDTH=256&HEIGHT=256&LAYERS=orto_s&STYLES="
],
tileSize:256
};
break;

case "TOPO":
sourceConfig = {
type:"raster",
tiles:[
"https://mapy.geoportal.gov.pl/wss/service/WMTS/guest/wmts/TOPO/Default/GoogleMapsCompatible/{z}/{y}/{x}.png"
],
tileSize:256
};
break;

case "VMap":
sourceConfig = {
type:"raster",
tiles:[
"https://mapy.geoportal.gov.pl/wss/service/PZGIK/mapy/WMS/SkorowidzVMap?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&CRS=EPSG:3857&WIDTH=256&HEIGHT=256&LAYERS=VMap0&STYLES="
],
tileSize:256
};
break;

}

/* dodanie nowego podkładu */

if(sourceConfig){

map.addSource("base_raster", sourceConfig);

map.addLayer({
id:"base_raster",
type:"raster",
source:"base_raster"
});

}

}

/* domyślny podkład po wejściu na stronę */

setBaseLayer("osm");
/* ===============================
GEOJSON SOURCE LOADER
=============================== */

async function ZDP_LOAD_GEO_SOURCES(map){

const [roads_main, roads_dp] = await Promise.all([
fetch("DK_i_DW.geojson").then(r=>r.json()),
fetch("DP.geojson").then(r=>r.json())
]);

const merged_roads = {
type:"FeatureCollection",
features:[
...(roads_main?.features || []),
...(roads_dp?.features || [])
]
};

if(map.getSource("zdp_roads")){
map.removeSource("zdp_roads");
}

map.addSource("zdp_roads",{
type:"geojson",
data:merged_roads
});

}

/* ===============================
ROAD LAYERS
=============================== */

function ADD_FILTER_LAYER(map, layerId, source, filterExpression, color, width){

    if(map.getLayer(layerId)) return;

    map.addLayer({
        id:layerId,
        type:"line",
        source:source,
        filter:filterExpression,
        paint:{
            "line-color":color,
            "line-width":width
        }
    });
}
function ZDP_RENDER_ROAD_STYLES(map){

ADD_FILTER_LAYER(map,"layer_adm_1","zdp_roads",["==",["get","Adm"],1],"#FF0000",3);
ADD_FILTER_LAYER(map,"layer_adm_2","zdp_roads",["==",["get","Adm"],2],"#08FF00",3);

ADD_FILTER_LAYER(map,"layer_zud_2","zdp_roads",["==",["get","ZUD"],2],"#FFEE00",6);
ADD_FILTER_LAYER(map,"layer_zud_3","zdp_roads",["==",["get","ZUD"],3],"#00FFFF",6);
ADD_FILTER_LAYER(map,"layer_zud_4","zdp_roads",["==",["get","ZUD"],4],"#FA9EFF",6);
ADD_FILTER_LAYER(map,"layer_zud_6","zdp_roads",["==",["get","ZUD"],6],"#A1A1A1",6);

ADD_FILTER_LAYER(map,"layer_adm_3","zdp_roads",["==",["get","Adm"],3],"#A500AD",3);

}

/* ===============================
LABELS
=============================== */

function ADD_LABEL_LAYER(map){

if(map.getLayer("road_id_labels")) return;

map.addLayer({
id:"road_id_labels",
type:"symbol",
source:"zdp_roads",

layout:{
"symbol-placement":"line",
"text-field":["get","ID"],
"text-font":["Open Sans Semibold"],
"text-size":12,
"text-anchor":"center",
"text-allow-overlap":false,
"text-ignore-placement":false,
"text-max-angle":30
},

paint:{

/* ===== Kolor tekstu zależny od Adm ===== */

"text-color":[
"case",

["==", ["get","Adm"], 1], "#FFFFFF",
["==", ["get","Adm"], 2], "#000000",
["==", ["get","Adm"], 3], "#FFFFFF",

"#000000"
],

/* ===== Halo / ramka ===== */

"text-halo-color":[
"case",

["==", ["get","Adm"], 1], "#FF0000",
["==", ["get","Adm"], 2], "#FFEE00",
["==", ["get","Adm"], 3], "#A500AD",

"#FFFFFF"
],

"text-halo-width":3,
"text-halo-blur":0.5

}

});

}

/* ===============================
LEGEND CONTROL
=============================== */

function ZDP_LEGEND_INIT(){

document.querySelectorAll('#legend input').forEach(chk=>{

chk.addEventListener('change',e=>{

const layers = e.target.dataset.layers.split(',');

layers.forEach(layerId=>{

if(!map.getLayer(layerId)) return;

map.setLayoutProperty(
layerId,
'visibility',
e.target.checked ? 'visible':'none'
);

});

});

});

}

/* ===============================
PIPELINE LOAD
=============================== */

map.on('load',async()=>{

await ZDP_LOAD_GEO_SOURCES(map);

ZDP_RENDER_ROAD_STYLES(map);

ADD_LABEL_LAYER(map);

ZDP_LEGEND_INIT();

/* timestamp */

document.getElementById("updateOverlay").innerText =
"Aktualizacja: " + new Date().toLocaleString("pl-PL");

});

</script>

</body>
</html>










