<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZDP Krosno Odrzańskie Mapa z Legendą</title>

<!-- MapLibre Open Source -->
<link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet"/>
<script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>

<style>
body { margin: 0; padding: 0; }

#map {
position: absolute;
top: 0;
bottom: 0;
width: 100%;
}

#legend {
position: absolute;
top: 10px;
left: 10px;
z-index: 1;
background: white;
padding: 10px;
border-radius: 5px;
box-shadow: 0 0 5px rgba(0,0,0,0.3);
font-family: Arial, sans-serif;
font-size: 14px;
}

.legend-line {
display: inline-block;
width: 40px;
border-bottom: 3px solid black;
margin-right: 5px;
vertical-align: middle;
}
</style>

</head>

<body>

<div id="legend">
<h3>Legenda</h3>

<label>
<input type="checkbox" data-layers="DK_i_DW_layer" checked>
<span class="legend-line" style="border-color:#FF0000;"></span>
Drogi krajowe / wojewódzkie
</label><br>

<label>
<input type="checkbox" data-layers="DP_layer" checked>
<span class="legend-line" style="border-color:#A500AD;"></span>
Drogi powiatowe
</label>

</div>

<div id="map"></div>

<script>

/* ===============================
   MAP INITIALIZATION
=============================== */

const map = new maplibregl.Map({
container: 'map',

style: {
version: 8,

sources: {

osm: {
type: "raster",
tiles: [
"https://tile.openstreetmap.org/{z}/{x}/{y}.png"
],
tileSize: 256,
attribution: "© OpenStreetMap contributors"
}

},

layers: [
{
id: "osm",
type: "raster",
source: "osm"
}
]

},

center: [15.1, 51.96],
zoom: 10
});

/* ===============================
   GEOJSON SOURCES
=============================== */

async function ZDP_LOAD_GEO_SOURCES(map){

try{

const roads_main = await fetch("DK_i_DW.geojson").then(r=>r.json());
const roads_dp = await fetch("DP.geojson").then(r=>r.json());

map.addSource("zdp_roads_main",{
type:"geojson",
data:roads_main
});

map.addSource("zdp_roads_dp",{
type:"geojson",
data:roads_dp
});

}catch(e){
console.error(e);
}

}

/* ===============================
   LAYERS
=============================== */

map.on('load', async()=>{

await ZDP_LOAD_GEO_SOURCES(map);

/* DK + DW */
map.addLayer({
id:"DK_i_DW_layer",
type:"line",
source:"zdp_roads_main",

paint:{
"line-color":[
"case",
["==",["get","Adm"],1],"#000000",
["==",["get","Adm"],2],"#08FF00",
"#FF0000"
],
"line-width":3
}
});

/* DP */
map.addLayer({
id:"DP_layer",
type:"line",
source:"zdp_roads_dp",

paint:{
"line-color":"#A500AD",
"line-width":3
}
});

/* LEGEND CONTROL */

document.querySelectorAll('#legend input').forEach(chk=>{
chk.addEventListener('change',e=>{

const layers=e.target.dataset.layers.split(',');

layers.forEach(layerId=>{

if(!map.getLayer(layerId)) return;

map.setLayoutProperty(
layerId,
'visibility',
e.target.checked ? 'visible':'none'
);

});

});
});

});

</script>

</body>
</html>
